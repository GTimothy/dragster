/*!
 * Dragster - drag'n'drop library v1.1.1
 * https://github.com/sunpietro/dragster
 *
 * Copyright 2015 Piotr Nalepa
 * http://blog.piotrnalepa.pl
 *
 * Released under the MIT license
 * https://github.com/sunpietro/dragster/blob/master/LICENSE
 *
 * Date: 2015-06-24T19:00Z
 */
(function(e,t){e.Dragster=function(n){var r="is-dragging",s="is-drag-over",a="dragster-draggable",i="dragster-drag-region",o="dragster-drop-placeholder",l="dragster-temp",c="dragster-temp-container",d="dragster-is-hidden",f="dragster-replacable",u=function(){},m={elementSelector:".dragster-block",regionSelector:".dragster-region",replaceElements:false,updateRegionsHeight:true,minimumRegionHeight:50,onBeforeDragStart:u,onAfterDragStart:u,onBeforeDragMove:u,onAfterDragMove:u,onBeforeDragEnd:u,onAfterDragEnd:u},g="draggable",p="data-placeholder-position",h={top:false,bottom:false},v,E,L,y,C,B,b,A,N,w,D,H,S,T,M,R,x,q,O,X,Y,I,P,k;for(v in n){if(n.hasOwnProperty(v)){m[v]=n[v]}}I=function(){return Array.prototype.slice.call(t.querySelectorAll(m.elementSelector))};P=function(e){e.forEach(function(e){var t=M(),n=e.parentNode;if(n.classList.contains(a)){return}n.insertBefore(t,e);n.removeChild(e);t.appendChild(e)})};A=I();E=Array.prototype.slice.call(t.querySelectorAll(m.regionSelector));if(m.replaceElements){B=t.createElement("div");B.classList.add(d);B.classList.add(c);t.body.appendChild(B)}L=function(e,t){var n=e.parentNode;if(!n||e.classList&&e.classList.contains(i)){return undefined}if(t(e)){return e}return t(n)?n:L(n,t)};O=function(e){var n=Array.prototype.slice.call(t.getElementsByClassName(e));n.forEach(function(e){e.parentNode.removeChild(e)})};X=function(e,n){E.forEach(function(e){e.removeEventListener(n,N.mousemove)});t.body.removeEventListener(n,N.mousemove);if(e){e.classList.remove(r)}Array.prototype.slice.call(t.getElementsByClassName(a)).forEach(function(e){if(!e.firstChild){e.parentNode.removeChild(e)}});O(o);O(l);k()};Y=function(){Array.prototype.slice.call(t.getElementsByClassName(f)).forEach(function(e){e.classList.remove(f)})};M=function(){var e=t.createElement("div");e.setAttribute(g,true);e.classList.add(a);return e};x=function(){var e=t.createElement("div");e.classList.add(o);return e};R=function(){var e=t.createElement("div");e.classList.add(l);e.classList.add(d);t.body.appendChild(e);return e};S=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}};T=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e)}};H=function(e){return e.classList&&e.classList.contains(i)};D=function(e){return e.classList&&e.classList.contains(a)};w=function(e){return e.classList&&e.classList.contains(o)};k=function(){if(m.updateRegionsHeight){var n=Array.prototype.slice.call(t.getElementsByClassName(i));n.forEach(function(t){var n=Array.prototype.slice.call(t.querySelectorAll(m.elementSelector)),r=m.minimumRegionHeight;if(n.length){n.forEach(function(t){var n=e.getComputedStyle(t);r+=t.offsetHeight+parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)})}t.style.height=r+"px"})}};N={mousedown:function(e){e.preventDefault();if(m.onBeforeDragStart()===false){return false}if(e.which===3){return false}var n,s=e.type==="touchstart"?"touchmove":"mousemove";E.forEach(function(e){e.addEventListener(s,N.mousemove)});t.body.addEventListener(s,N.mousemove);b=L(e.target,D);if(!b){return false}n=b.getBoundingClientRect();y=R();y.innerHTML=b.innerHTML;y.style.width=n.width+"px";y.style.height=n.height+"px";C=y.getBoundingClientRect();b.classList.add(r);m.onAfterDragStart()},mousemove:function(e){e.preventDefault();if(m.onBeforeDragMove()===false){return false}var n=e.changedTouches?e.changedTouches[0]:e,r=n.view?n.view.pageXOffset:0,s=n.view?n.view.pageYOffset:0,l=n.clientY+s,c=n.clientX+r,u=t.elementFromPoint(n.clientX,n.clientY),g=L(u,D),v,E,B;clearTimeout(q);y.style.top=l+25+"px";y.style.left=c-C.width/2+"px";y.classList.remove(d);if(g&&g!==b){B=x();v=g.getBoundingClientRect();E=v.height/2;Y();if(!m.replaceElements){if(l-v.top<E&&!h.top){O(o);B.setAttribute(p,"top");T(g.firstChild,B)}else if(v.bottom-l<E&&!h.bottom){O(o);B.setAttribute(p,"bottom");g.appendChild(B)}}else{g.classList.add(f)}}else if(u.classList.contains(i)&&u.getElementsByClassName(a).length===0&&u.getElementsByClassName(o).length===0){B=x();u.appendChild(B)}else if(u.classList.contains(i)&&u.getElementsByClassName(a).length>0&&u.getElementsByClassName(o).length===0){var A=u.getElementsByClassName(a);B=x();B.setAttribute(p,"bottom");O(o);A[A.length-1].appendChild(B)}else if(!u.classList.contains(i)){if(!m.replaceElements){O(o)}else{Y()}}k();m.onAfterDragMove()},mouseup:function(e){if(m.onBeforeDragEnd()===false){return false}var n=m.replaceElements?f:o,r=t.getElementsByClassName(n)[0],a,i,l=e.type==="touchstart"?"touchmove":"mousemove",d;q=setTimeout(function(){X(b,l)},200);Y();if(!b||!r){X(b,l);return false}a=L(r,D);a=a||r;if(b!==a){if(!m.replaceElements){d=M();i=r.getAttribute(p);if(i==="top"){T(a,d)}else{S(a,d)}if(b.firstChild){d.appendChild(b.firstChild)}}else{d=t.getElementsByClassName(c)[0];d.innerHTML=b.innerHTML;b.innerHTML=a.innerHTML;a.innerHTML=d.innerHTML;d.innerHTML=""}a.classList.remove(s)}X(b,l);m.onAfterDragEnd()}};P(A);t.body.addEventListener("mouseup",N.mouseup,false);t.body.addEventListener("touchend",N.mouseup,false);E.forEach(function(e){e.classList.add(i);e.addEventListener("mousedown",N.mousedown,false);e.addEventListener("mouseup",N.mouseup,false);e.addEventListener("touchstart",N.mousedown,false);e.addEventListener("touchend",N.mouseup,false)});return{update:function(){P(I());k()}}}})(window,window.document);
