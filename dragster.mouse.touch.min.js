/*!
 * Dragster - drag'n'drop library v1.1.0
 * https://github.com/sunpietro/dragster
 *
 * Copyright 2015 Piotr Nalepa
 * http://blog.piotrnalepa.pl
 *
 * Released under the MIT license
 * https://github.com/sunpietro/dragster/blob/master/LICENSE
 *
 * Date: 2015-05-26T19:00Z
 */
(function(e,t){e.Dragster=function(n){var s="is-dragging",i="is-drag-over",r="dragster-draggable",a="dragster-drag-region",o="dragster-drop-placeholder",l="dragster-temp",c="dragster-temp-container",d="dragster-is-hidden",u="dragster-replacable",f={elementSelector:".dragster-block",regionSelector:".dragster-region",replaceElements:false,updateRegionsHeight:true,minimumRegionHeight:50},m="draggable",p="data-placeholder-position",g={top:false,bottom:false},h,v,L,y,E,C,b,N,B,w,A,H,T,S,M,R,x,q,D,O,X,Y,I,P;for(h in n){if(n.hasOwnProperty(h)){f[h]=n[h]}}Y=function(){return Array.prototype.slice.call(t.querySelectorAll(f.elementSelector))};I=function(e){e.forEach(function(e){var t=M(),n=e.parentNode;if(n.classList.contains(r)){return}n.insertBefore(t,e);n.removeChild(e);t.appendChild(e)})};N=Y();v=Array.prototype.slice.call(t.querySelectorAll(f.regionSelector));if(f.replaceElements){C=t.createElement("div");C.classList.add(d);C.classList.add(c);t.body.appendChild(C)}L=function(e,t){var n=e.parentNode;if(!n||e.classList&&e.classList.contains(a)){return undefined}if(t(e)){return e}return t(n)?n:L(n,t)};D=function(e){var n=Array.prototype.slice.call(t.getElementsByClassName(e));n.forEach(function(e){e.parentNode.removeChild(e)})};O=function(e,n){v.forEach(function(e){e.removeEventListener(n,B.mousemove)});t.body.removeEventListener(n,B.mousemove);if(e){e.classList.remove(s)}Array.prototype.slice.call(t.getElementsByClassName(r)).forEach(function(e){if(!e.firstChild){e.parentNode.removeChild(e)}});D(o);D(l);P()};X=function(){Array.prototype.slice.call(t.getElementsByClassName(u)).forEach(function(e){e.classList.remove(u)})};M=function(){var e=t.createElement("div");e.setAttribute(m,true);e.classList.add(r);return e};x=function(){var e=t.createElement("div");e.classList.add(o);return e};R=function(){var e=t.createElement("div");e.classList.add(l);e.classList.add(d);t.body.appendChild(e);return e};T=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}};S=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e)}};H=function(e){return e.classList&&e.classList.contains(a)};A=function(e){return e.classList&&e.classList.contains(r)};w=function(e){return e.classList&&e.classList.contains(o)};P=function(){if(f.updateRegionsHeight){var n=Array.prototype.slice.call(t.getElementsByClassName(a));n.forEach(function(t){var n=Array.prototype.slice.call(t.querySelectorAll(f.elementSelector)),s=f.minimumRegionHeight;if(n.length){n.forEach(function(t){var n=e.getComputedStyle(t);s+=t.offsetHeight+parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)})}t.style.height=s+"px"})}};B={mousedown:function(e){e.preventDefault();if(e.which===3){return false}var n,i=e.type==="touchstart"?"touchmove":"mousemove";v.forEach(function(e){e.addEventListener(i,B.mousemove)});t.body.addEventListener(i,B.mousemove);b=L(e.target,A);if(!b){return false}n=b.getBoundingClientRect();y=R();y.innerHTML=b.innerHTML;y.style.width=n.width+"px";y.style.height=n.height+"px";E=y.getBoundingClientRect();b.classList.add(s)},mousemove:function(e){e.preventDefault();var n=e.changedTouches?e.changedTouches[0]:e,s=n.view?n.view.pageXOffset:0,i=n.view?n.view.pageYOffset:0,l=n.clientY+i,c=n.clientX+s,m=t.elementFromPoint(n.clientX,n.clientY),h=L(m,A),v,C,N;clearTimeout(q);y.style.top=l+25+"px";y.style.left=c-E.width/2+"px";y.classList.remove(d);if(h&&h!==b){N=x();v=h.getBoundingClientRect();C=v.height/2;X();if(!f.replaceElements){if(l-v.top<C&&!g.top){D(o);N.setAttribute(p,"top");S(h.firstChild,N)}else if(v.bottom-l<C&&!g.bottom){D(o);N.setAttribute(p,"bottom");h.appendChild(N)}}else{h.classList.add(u)}}else if(m.classList.contains(a)&&m.getElementsByClassName(r).length===0&&m.getElementsByClassName(o).length===0){N=x();m.appendChild(N)}else if(m.classList.contains(a)&&m.getElementsByClassName(r).length>0&&m.getElementsByClassName(o).length===0){var B=m.getElementsByClassName(r);N=x();N.setAttribute(p,"bottom");D(o);B[B.length-1].appendChild(N)}else if(!m.classList.contains(a)){if(!f.replaceElements){D(o)}else{X()}}P()},mouseup:function(e){var n=f.replaceElements?u:o,s=t.getElementsByClassName(n)[0],r,a,l=e.type==="touchstart"?"touchmove":"mousemove",d;q=setTimeout(function(){O(b,l)},200);X();if(!b||!s){O(b,l);return false}r=L(s,A);r=r||s;if(b!==r){if(!f.replaceElements){d=M();a=s.getAttribute(p);if(a==="top"){S(r,d)}else{T(r,d)}if(b.firstChild){d.appendChild(b.firstChild)}}else{d=t.getElementsByClassName(c)[0];d.innerHTML=b.innerHTML;b.innerHTML=r.innerHTML;r.innerHTML=d.innerHTML;d.innerHTML=""}r.classList.remove(i)}O(b,l)}};I(N);t.body.addEventListener("mouseup",B.mouseup,false);t.body.addEventListener("touchend",B.mouseup,false);v.forEach(function(e){e.classList.add(a);e.addEventListener("mousedown",B.mousedown,false);e.addEventListener("mouseup",B.mouseup,false);e.addEventListener("touchstart",B.mousedown,false);e.addEventListener("touchend",B.mouseup,false)});return{update:function(){I(Y());P()}}}})(window,window.document);
