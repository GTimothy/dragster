(function(e,t){"use strict";e.Dragster=function(n){var r="is-dragging",o="is-drag-over",i="dragster-draggable",s="dragster-drag-region",a="dragster-drop-placeholder",l="dragster-temp",d="dragster-temp-container",c="dragster-is-hidden",f="dragster-replacable",u="touchstart",g="touchmove",m="touchend",p="mousedown",h="mousemove",v="mouseup",E="top",L="bottom",y="px",C="div",B=false,w=true,b=function(){},N={elementSelector:".dragster-block",regionSelector:".dragster-region",replaceElements:B,updateRegionsHeight:w,minimumRegionHeight:50,onBeforeDragStart:b,onAfterDragStart:b,onBeforeDragMove:b,onAfterDragMove:b,onBeforeDragEnd:b,onAfterDragEnd:b,scrollWindowOnDrag:B},D="draggable",H="data-placeholder-position",T={top:B,bottom:B},A={drag:{node:{}},drop:{node:{}},shadow:{node:{},top:0,left:0},placeholder:{node:{},position:""}},S,M,R,Y,O,q,x,X,I,P,W,k,z,F,j,G,J,K,Q,U,V,Z,$,_,ee,te,ne,re=t.body.offsetHeight,oe=e.innerHeight;for(M in n){if(n.hasOwnProperty(M)){N[M]=n[M]}}$=function(){return[].slice.call(t.querySelectorAll(N.elementSelector))};_=function(e){e.forEach(function(e){var t=G(),n=e.parentNode;if(n.classList.contains(i)){return B}n.insertBefore(t,e);n.removeChild(e);t.appendChild(e)})};I=$();R=[].slice.call(t.querySelectorAll(N.regionSelector));if(N.replaceElements){x=t.createElement(C);x.classList.add(c);x.classList.add(d);t.body.appendChild(x)}Y=function(e,t){var n=e.parentNode;if(!n||e.classList&&e.classList.contains(s)){return undefined}if(t(e)){return e}return t(n)?n:Y(n,t)};U=function(e){var n=[].slice.call(t.getElementsByClassName(e));n.forEach(function(e){e.parentNode.removeChild(e)})};V=function(e,n){R.forEach(function(e){e.removeEventListener(n,P.mousemove)});t.body.removeEventListener(n,P.mousemove);if(e){e.classList.remove(r)}[].slice.call(t.getElementsByClassName(i)).forEach(function(e){if(!e.firstChild){e.parentNode.removeChild(e)}});U(a);U(l);ee()};Z=function(){[].slice.call(t.getElementsByClassName(f)).forEach(function(e){e.classList.remove(f)})};G=function(){var e=t.createElement(C);e.setAttribute(D,w);e.classList.add(i);return e};K=function(){var e=t.createElement(C);e.classList.add(a);return e};J=function(){var e=t.createElement(C);e.classList.add(l);e.classList.add(c);e.style.position="fixed";t.body.appendChild(e);return e};F=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}};j=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e)}};z=function(e){return e.classList&&e.classList.contains(s)};k=function(e){return e.classList&&e.classList.contains(i)};W=function(e){return e.classList&&e.classList.contains(a)};ee=function(){if(N.updateRegionsHeight){var n=[].slice.call(t.getElementsByClassName(s));n.forEach(function(t){var n=[].slice.call(t.querySelectorAll(N.elementSelector)),r=N.minimumRegionHeight;if(n.length){n.forEach(function(t){var n=e.getComputedStyle(t);r+=t.offsetHeight+parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)})}t.style.height=r+y})}};P={mousedown:function(e){e.dragster=S;if(N.onBeforeDragStart(e)===B||e.which===3){return B}e.preventDefault();var n,o=e.type===u?g:h;R.forEach(function(e){e.addEventListener(o,P.mousemove)});t.body.addEventListener(o,P.mousemove);X=Y(e.target,k);if(!X){return B}n=X.getBoundingClientRect();O=J();O.innerHTML=X.innerHTML;O.style.width=n.width+y;O.style.height=n.height+y;q=O.getBoundingClientRect();X.classList.add(r);S=A;S.drag.node=X;S.shadow.node=O;e.dragster=S;N.onAfterDragStart(e)},mousemove:function(e){e.dragster=S;if(N.onBeforeDragMove(e)===B){return B}e.preventDefault();var n=e.changedTouches?e.changedTouches[0]:e,r=n.view?n.view.pageXOffset:0,o=n.view?n.view.pageYOffset:0,l=n.clientY+o,d=n.clientX+r,u=t.elementFromPoint(n.clientX,n.clientY),g=Y(u,k),m=n.clientY,p=d-q.width/2,h=K(),v,C;clearTimeout(Q);O.style.top=m+y;O.style.left=p+y;O.classList.remove(c);S.shadow.top=m;S.shadow.left=p;if(g&&g!==X){v=g.getBoundingClientRect();C=v.height/2;Z();if(!N.replaceElements){if(l-v.top<C&&!T.top){U(a);h.setAttribute(H,E);j(g.firstChild,h);S.placeholder.position=E}else if(v.bottom-l<C&&!T.bottom){U(a);h.setAttribute(H,L);g.appendChild(h);S.placeholder.position=L}}else{g.classList.add(f)}S.placeholder.node=h;S.drop.node=g}else if(u.classList.contains(s)&&u.getElementsByClassName(i).length===0&&u.getElementsByClassName(a).length===0){u.appendChild(h);S.placeholder.position=L;S.placeholder.node=h;S.drop.node=u}else if(u.classList.contains(s)&&u.getElementsByClassName(i).length>0&&u.getElementsByClassName(a).length===0){var w=u.getElementsByClassName(i);g=w[w.length-1];h.setAttribute(H,L);U(a);g.appendChild(h);S.placeholder.position=L;S.placeholder.node=h;S.drop.node=g}else if(!u.classList.contains(s)){if(!N.replaceElements){U(a)}else{Z()}}if(N.scrollWindowOnDrag){te(e)}ee();N.onAfterDragMove(e)},mouseup:function(e){e.dragster=S;if(N.onBeforeDragEnd(e)===B){return B}var n=N.replaceElements?f:a,r=t.getElementsByClassName(n)[0],i,s,l=e.type===u?g:h,c;Q=setTimeout(function(){V(X,l)},200);Z();if(!X||!r){V(X,l);return B}i=Y(r,k);i=i||r;if(X!==i){if(!N.replaceElements){c=G();s=r.getAttribute(H);if(s===E){j(i,c)}else{F(i,c)}if(X.firstChild){c.appendChild(X.firstChild)}}else{c=t.getElementsByClassName(d)[0];c.innerHTML=X.innerHTML;X.innerHTML=i.innerHTML;i.innerHTML=c.innerHTML;c.innerHTML=""}i.classList.remove(o)}V(X,l);N.onAfterDragEnd(e)}};te=function(t){var n=t.changedTouches?t.changedTouches[0]:t,r=60;if(oe-n.clientY<r){e.scrollBy(0,10)}else if(n.clientY<r){e.scrollBy(0,-10)}};ne=function(){oe=e.innerHeight};_(I);t.body.addEventListener(v,P.mouseup,B);t.body.addEventListener(m,P.mouseup,B);R.forEach(function(e){e.classList.add(s);e.addEventListener(p,P.mousedown,B);e.addEventListener(v,P.mouseup,B);e.addEventListener(u,P.mousedown,B);e.addEventListener(m,P.mouseup,B)});e.addEventListener("resize",ne,false);return{update:function(){_($());ee();ne()}}}})(window,window.document);