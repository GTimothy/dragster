/*@preserve
 * Dragster - drag'n'drop library v1.1.2
 * https://github.com/sunpietro/dragster
 *
 * Copyright 2015 Piotr Nalepa
 * http://blog.piotrnalepa.pl
 *
 * Released under the MIT license
 * https://github.com/sunpietro/dragster/blob/master/LICENSE
 *
 * Date: 2015-06-24T19:00Z
 */
(function(e,t){"use strict";e.Dragster=function(n){var r="is-dragging",s="is-drag-over",a="dragster-draggable",i="dragster-drag-region",o="dragster-drop-placeholder",l="dragster-temp",c="dragster-temp-container",d="dragster-is-hidden",f="dragster-replacable",u="touchstart",m="touchmove",g="touchend",p="mousedown",h="mousemove",v="mouseup",E="top",L="bottom",y="px",C="div",B=function(){},A={elementSelector:".dragster-block",regionSelector:".dragster-region",replaceElements:false,updateRegionsHeight:true,minimumRegionHeight:50,onBeforeDragStart:B,onAfterDragStart:B,onBeforeDragMove:B,onAfterDragMove:B,onBeforeDragEnd:B,onAfterDragEnd:B},b="draggable",N="data-placeholder-position",w={top:false,bottom:false},D,H,S,T,M,R,q,O,X,Y,x,I,P,k,F,j,z,G,J,K,Q,U,V,W;for(D in n){if(n.hasOwnProperty(D)){A[D]=n[D]}}U=function(){return Array.prototype.slice.call(t.querySelectorAll(A.elementSelector))};V=function(e){e.forEach(function(e){var t=F(),n=e.parentNode;if(n.classList.contains(a)){return}n.insertBefore(t,e);n.removeChild(e);t.appendChild(e)})};O=U();H=Array.prototype.slice.call(t.querySelectorAll(A.regionSelector));if(A.replaceElements){R=t.createElement(C);R.classList.add(d);R.classList.add(c);t.body.appendChild(R)}S=function(e,t){var n=e.parentNode;if(!n||e.classList&&e.classList.contains(i)){return undefined}if(t(e)){return e}return t(n)?n:S(n,t)};J=function(e){var n=Array.prototype.slice.call(t.getElementsByClassName(e));n.forEach(function(e){e.parentNode.removeChild(e)})};K=function(e,n){H.forEach(function(e){e.removeEventListener(n,X.mousemove)});t.body.removeEventListener(n,X.mousemove);if(e){e.classList.remove(r)}Array.prototype.slice.call(t.getElementsByClassName(a)).forEach(function(e){if(!e.firstChild){e.parentNode.removeChild(e)}});J(o);J(l);W()};Q=function(){Array.prototype.slice.call(t.getElementsByClassName(f)).forEach(function(e){e.classList.remove(f)})};F=function(){var e=t.createElement(C);e.setAttribute(b,true);e.classList.add(a);return e};z=function(){var e=t.createElement(C);e.classList.add(o);return e};j=function(){var e=t.createElement(C);e.classList.add(l);e.classList.add(d);t.body.appendChild(e);return e};P=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}};k=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e)}};I=function(e){return e.classList&&e.classList.contains(i)};x=function(e){return e.classList&&e.classList.contains(a)};Y=function(e){return e.classList&&e.classList.contains(o)};W=function(){if(A.updateRegionsHeight){var n=Array.prototype.slice.call(t.getElementsByClassName(i));n.forEach(function(t){var n=Array.prototype.slice.call(t.querySelectorAll(A.elementSelector)),r=A.minimumRegionHeight;if(n.length){n.forEach(function(t){var n=e.getComputedStyle(t);r+=t.offsetHeight+parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)})}t.style.height=r+y})}};X={mousedown:function(e){if(A.onBeforeDragStart(e)===false||e.which===3){return false}e.preventDefault();var n,s=e.type===u?m:h;H.forEach(function(e){e.addEventListener(s,X.mousemove)});t.body.addEventListener(s,X.mousemove);q=S(e.target,x);if(!q){return false}n=q.getBoundingClientRect();T=j();T.innerHTML=q.innerHTML;T.style.width=n.width+y;T.style.height=n.height+y;M=T.getBoundingClientRect();q.classList.add(r);A.onAfterDragStart(e)},mousemove:function(e){if(A.onBeforeDragMove(e)===false){return false}e.preventDefault();var n=e.changedTouches?e.changedTouches[0]:e,r=n.view?n.view.pageXOffset:0,s=n.view?n.view.pageYOffset:0,l=n.clientY+s,c=n.clientX+r,u=t.elementFromPoint(n.clientX,n.clientY),m=S(u,x),g,p,h;clearTimeout(G);T.style.top=l+25+y;T.style.left=c-M.width/2+y;T.classList.remove(d);if(m&&m!==q){h=z();g=m.getBoundingClientRect();p=g.height/2;Q();if(!A.replaceElements){if(l-g.top<p&&!w.top){J(o);h.setAttribute(N,E);k(m.firstChild,h)}else if(g.bottom-l<p&&!w.bottom){J(o);h.setAttribute(N,L);m.appendChild(h)}}else{m.classList.add(f)}}else if(u.classList.contains(i)&&u.getElementsByClassName(a).length===0&&u.getElementsByClassName(o).length===0){h=z();u.appendChild(h)}else if(u.classList.contains(i)&&u.getElementsByClassName(a).length>0&&u.getElementsByClassName(o).length===0){var v=u.getElementsByClassName(a);h=z();h.setAttribute(N,L);J(o);v[v.length-1].appendChild(h)}else if(!u.classList.contains(i)){if(!A.replaceElements){J(o)}else{Q()}}W();A.onAfterDragMove(e)},mouseup:function(e){if(A.onBeforeDragEnd(e)===false){return false}var n=A.replaceElements?f:o,r=t.getElementsByClassName(n)[0],a,i,l=e.type===u?m:h,d;G=setTimeout(function(){K(q,l)},200);Q();if(!q||!r){K(q,l);return false}a=S(r,x);a=a||r;if(q!==a){if(!A.replaceElements){d=F();i=r.getAttribute(N);if(i===E){k(a,d)}else{P(a,d)}if(q.firstChild){d.appendChild(q.firstChild)}}else{d=t.getElementsByClassName(c)[0];d.innerHTML=q.innerHTML;q.innerHTML=a.innerHTML;a.innerHTML=d.innerHTML;d.innerHTML=""}a.classList.remove(s)}K(q,l);A.onAfterDragEnd(e)}};V(O);t.body.addEventListener(v,X.mouseup,false);t.body.addEventListener(g,X.mouseup,false);H.forEach(function(e){e.classList.add(i);e.addEventListener(p,X.mousedown,false);e.addEventListener(v,X.mouseup,false);e.addEventListener(u,X.mousedown,false);e.addEventListener(g,X.mouseup,false)});return{update:function(){V(U());W()}}}})(window,window.document);